{% extends "chama/loginBase.html" %}
{% load static %}

{% block content %}
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="{% url 'manager:dashboard' %}" class="logo d-flex align-items-center">
        <img src="{% static 'chama/img/favicon.png' %}" alt="">
        <span class="d-none d-lg-block">Dashboard</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <!-- <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form> -->
    </div>
    <!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bi bi-search"></i>
          </a>
        </li><!-- End Search Icon-->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <!-- <img src="{{ chama.manager_profile_picture }}" alt="Profile" class="rounded-circle img-fluid"> -->
            <i class="bi bi-person-circle">manager</i>
            <span class="d-none d-md-block dropdown-toggle ps-2"></span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <hr class="dropdown-divider">
            </li>

            <!-- <li>
              <a class="dropdown-item d-flex align-items-center" href="#">
                <i class="bi bi-question-circle"></i>
                <span>Need Help?</span>
              </a>
            </li> -->
            <li>
              <hr class="dropdown-divider">
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="{% url 'chama:signout' %}">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-heading">Pages</li>

      <!-- <li class="nav-item">
        <a class="nav-link collapsed" href="">
          <i class="ri-close-circle-line"></i>
          <span>Missed Rotation Contributions</span>
        </a>
      </li> -->

    </ul>

  </aside><!-- End Sidebar-->

  <main id="main" class="main">
    <div class="pagetitle d-flex justify-content-between align-items-center">
      <h1>{{ activity_name }}</h1>

        <div class="search-bar">
          {% if messages %}
          <div class="alert alert-success alert-dismissible fade show" role="alert" id="chama_created">
            {% for messages in messages %}
              <strong>{{ messages }}</strong>
            {% endfor %}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}
        </div>
      
      <div class="ml-auto">
        <!-- <form method="POST" action="{% url 'manager:disburse_funds' activity_id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success btn-sm" id="disburseBtn">
            Disburse Funds
          </button>
        </form> -->

      </div>



    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- increase number shares card -->
            <div class="col-xxl-4 col-md-4">
              <div class="card info-card sales-card clickable-card" id="increaseSharesCard" >

                <div class="card-body">
                  <h5 class="card-title">Increase Number Shares <span>| Existing members</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri-arrow-up-double-fill"></i>
                    </div>
                    <div class="ps-3">
                      <span class="text-muted small pt-2 ps-1">Allow members to increase their shares.</span>
                    </div>
                  </div>
                </div>

              </div>

            </div><!-- End of increase number shares card -->

            <!-- Allow new member card -->
            <div class="col-xxl-4 col-md-4" >
              <div class="card info-card revenue-card clickable-card" id="allowNewMembersCard">

                <div class="card-body">
                  <h5 class="card-title">Allow New Members<span>| Members Joining Late</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri-add-line"></i>
                    </div>
                    <div class="ps-3">
                      <span class="text-success pt-2 fw-bold">                     
                      </span> <span class="text-muted small pt-2 ps-1">
                        Allow new members to join the activity even after it has started.
                      </span>
    
                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End of Allow new member card -->

            <!-- swap order numbers card -->
            <div class="col-xxl-4 col-md-4 clickable-card" id="swapOrder">
              <div class="card info-card revenue-card">

                <div class="card-body">
                  <h5 class="card-title">Swap Order Numbers <span>| <button class="btn btn-danger btn-sm" type="button">coming soon</button> </span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri-swap-fill"></i>
                    </div>
                    <div class="ps-3">
                      <span class="text-success pt-2 fw-bold">
                      </span> <span class="text-muted small pt-2 ps-1">
                        Allow members to swap their order numbers.
                      </span>

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End swap order numbers Card -->

            <!-- decrease number shares card -->
            <div class="col-xxl-4 col-md-4 clickable-card" id="reduceSharesCard">
              <div class="card info-card revenue-card">

                <div class="card-body">
                  <h5 class="card-title">Reduce Number of Shares <span>|<button class="btn btn-danger btn-sm" type="button">coming soon</button> </span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri-arrow-down-double-line"></i>
                    </div>
                    <div class="ps-3">
                      <span class="text-success pt-2 fw-bold">
                      </span> <span class="text-muted small pt-2 ps-1">
                        Allow members to reduce their shares.
                      </span>

                    </div>
                  </div>
                </div>

              </div>

            </div><!-- End of decrease number shares card -->

             <!-- increase shares form -->
             <div class="card shadow-lg border-0" id="increaseSharesForm" style="display: none; background-color: #f9fafc;">
              <div class="card-body p-4">
                <div class="card-title text-success">
                  <h5 class="teko-text">Allow Existing Members to Increase Their Shares</h5>
                  <hr>
                </div>
                <div class="pagetitle d-flex justify-content-between align-items-center mb-4">
                  <p class="arima-text text-secondary">
                    You can set the maximum number of shares that members can have, the deadline for adding shares and a fee for late share adjustments if any.
                    Members increasing shares will need to cover any past contributions for the new shares before the adjustment is made.
                  </p>
                </div>
            
                <form class="p-3" action="{% url 'manager:merry_go_round_share_increase' activity_id %}" method="POST">
                  {% csrf_token %}
                  <!-- Maximum shares input -->
                  <div class="mb-3">
                    <label for="max_addon" class="form-label fw-bold arima-text text-secondary">Maximum Number of Shares Users Can Have</label>
                    <div class="input-group">
                      <span class="input-group-text bg-light text-secondary fw-bold">Shares:</span>
                      <input type="number" class="form-control border-0 shadow-sm" id="max_addon" name="max_addon" min="1" required>
                      <small class="amount-error-message text-danger"></small>
                    </div>
                  </div>
            
                  <!-- Deadline input -->
                  <div class="mb-3" id="deadline">
                    <label for="deadline" class="form-label fw-bold arima-text text-secondary">Final Date to Add Shares</label>
                    <div class="input-group">
                      <input type="date" class="form-control border-0 shadow-sm" id="deadline" name="deadline" required>
                    </div>
                    <small class="notify-manager text-danger">This date must be earlier than the next rotation date.</small>
                  </div>
            
                  <!-- Late fee input -->
                  <div class="mb-3" id="late_fee">
                    <label for="walletnumber" class="form-label fw-bold arima-text text-secondary">Late Share Adjustment Fee</label>
                    <div class="input-group">
                      <input type="number" class="form-control border-0 shadow-sm" id="late_fee" name="late_fee" placeholder="Enter 0 if there is no fee" required>
                    </div>
                    <small class="fee-error-message text-danger"></small>
                  </div>
            
                  <!-- Notify members options -->
                  <div class="mb-3">
                    <label class="form-label fw-bold text-secondary arima-text">Notify Members *</label>
                    <small class="text-muted d-block mb-2">Notify members that they can now increase their shares.</small>
                    <div class="d-flex align-items-center">
                      <div class="form-check form-switch me-3">
                        <input type="checkbox" class="form-check-input" id="notify" name="notify" onclick="toggleCheckBox('notify', 'dont_notify')">
                        <label class="form-check-label text-dark" for="notify">Notify Members</label>
                      </div>
                      <div class="form-check form-switch">
                        <input type="checkbox" class="form-check-input" id="dont_notify" name="dont_notify" onclick="toggleCheckBox('dont_notify', 'notify')">
                        <label class="form-check-label text-dark" for="dont_notify">Don't Notify Members</label>
                      </div>
                    </div>
                    <small class="error-message text-danger" id="notifyError" style="display: none;">Please select whether to notify members or not.</small>
                  </div>
            
                  <!-- Buttons -->
                  <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-danger btn-sm me-2 close-btn">Close</button>
                    <button type="submit" class="btn btn-success btn-sm">Activate Share Increase</button>
                  </div>
                </form>
                <script>
                  function toggleCheckBox(selectedid, unselectedid) {
                    const selectedCheckbox = document.getElementById(selectedid);
                    const unselectedCheckbox = document.getElementById(unselectedid);
            
                    if (selectedCheckbox.checked) {
                      unselectedCheckbox.checked = false;
                    }
            
                    // check if neither of the checkboxes is checked, show error message
                    const notifyError = document.getElementById('notifyError');
                    if (!selectedCheckbox.checked && !unselectedCheckbox.checked) {
                      notifyError.style.display = 'block';
                    } else {
                      notifyError.style.display = 'none';
                    }
                  }
                </script>
              </div>
            </div> <!-- End increase shares form -->
            

            <!-- allowNewMembers form -->
            <!-- increase shares form -->
            <div class="card shadow-lg border-0" id="allowNewMembersForm" style="display: none; background-color: #f9fafc;">
              <div class="card-body p-4">
                <div class="card-title text-success">
                  <h5 class="teko-text">Allow Late Members to Join the Activity</h5>
                  <hr>
                </div>
                <div class="pagetitle d-flex justify-content-between align-items-center mb-4">
                  <p class="arima-text text-secondary">
                    You can set the maximum number of shares that members can have, the deadline for joining the activity and a fee for late share adjustments if any.
                    New members will need to cover any past contributions for the new shares before the adjustment is made.
                  </p>
                </div>
            
                <form class="p-3" action="{% url 'manager:allow_new_activity_members' activity_id %}" method="POST">
                  {% csrf_token %}
                  <!-- Maximum shares input -->
                  <div class="mb-3">
                    <label for="max_addon" class="form-label fw-bold arima-text text-secondary">Maximum Number of Shares New Members Can Have</label>
                    <div class="input-group">
                      <span class="input-group-text bg-light text-secondary fw-bold">Shares:</span>
                      <input type="number" class="form-control border-0 shadow-sm" id="max_shares" name="max_shares" min="1" required>
                      <small class="amount-error-message text-danger"></small>
                    </div>
                  </div>
            
                  <!-- Deadline input -->
                  <div class="mb-3" id="deadline">
                    <label for="deadline" class="form-label fw-bold arima-text text-secondary">Final Date to Join</label>
                    <div class="input-group">
                      <input type="date" class="form-control border-0 shadow-sm" id="deadline" name="deadline" required>
                    </div>
                    <small class="notify-manager text-danger">This date must be earlier than the next rotation date.</small>
                  </div>
            
                  <!-- Late fee input -->
                  <div class="mb-3" id="late_fee">
                    <label for="walletnumber" class="form-label fw-bold arima-text text-secondary">Late Adjustment Fee</label>
                    <div class="input-group">
                      <input type="number" class="form-control border-0 shadow-sm" id="late_fee" name="late_fee" placeholder="Enter 0 if there is no fee" required>
                    </div>
                    <small class="fee-error-message text-danger"></small>
                  </div>
            
                  <!-- Buttons -->
                  <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-outline-danger btn-sm me-2 close-btn">Close</button>
                    <button type="submit" class="btn btn-success btn-sm">Allow New Members</button>
                  </div>
                </form>
                <script>
                  function toggleCheckBox(selectedid, unselectedid) {
                    const selectedCheckbox = document.getElementById(selectedid);
                    const unselectedCheckbox = document.getElementById(unselectedid);
            
                    if (selectedCheckbox.checked) {
                      unselectedCheckbox.checked = false;
                    }
            
                    // check if neither of the checkboxes is checked, show error message
                    const notifyError = document.getElementById('notifyError');
                    if (!selectedCheckbox.checked && !unselectedCheckbox.checked) {
                      notifyError.style.display = 'block';
                    } else {
                      notifyError.style.display = 'none';
                    }
                  }
                </script>
              </div>
            </div> <!-- End increase shares form -->

          </div>
        </div><!-- End Left side columns -->
        
      </div>

    </section>

  </main><!-- End #main -->

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const cards = document.querySelectorAll('.clickable-card');
    const forms = document.querySelectorAll('.card-body + .card');


    // retrieve all card ids
    const increaseSharesCard = document.getElementById('increaseSharesCard');
    const increaseSharesForm = document.getElementById('increaseSharesForm');

    const allowNewMembersCard = document.getElementById('allowNewMembersCard');
    const allowNewMembersForm = document.getElementById('allowNewMembersForm');

    const swapOrder = document.getElementById('swapOrder');
    const swapOrderForm = document.getElementById('swapOrderForm');

    const reduceSharesCard = document.getElementById('reduceSharesCard');
    const reduceSharesForm = document.getElementById('reduceSharesForm');

    // show the form when the card is clicked and hide all other cards
    increaseSharesCard.addEventListener('click', function() {
      increaseSharesForm.style.display = 'block';
      cards.forEach(c => {
        if (c !== increaseSharesForm) {
          c.style.display = 'none';
        }
      });
    });

    allowNewMembersCard.addEventListener('click', function() {
      allowNewMembersForm.style.display = 'block';
      allowNewMembersCard.style.display = 'block';
      cards.forEach(c => {
        if (c !== allowNewMembersForm) {
          c.style.display = 'none';
        }
      });
    });

    swapOrder.addEventListener('click', function() {
      swapOrderForm.style.display = 'block';
      cards.forEach(c => {
        if (c !== swapOrderForm) {
          c.style.display = 'none';
        }
      });
    });


    reduceSharesCard.addEventListener('click', function() {
      reduceSharesForm.style.display = 'block';
      cards.forEach(c => {
        if (c !== reduceSharesForm) {
          c.style.display = 'none';
        }
      });
    });
   
    
    // Close button functionality
    const closeButtons = document.querySelectorAll('.close-btn');
    closeButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Hide the form
        this.closest('.card').style.display = 'none';
        
        // Show all cards again
        cards.forEach(c => c.style.display = 'block');
      });
    });

    
  });
</script>

<style>
  /* Beautiful styling for the paragraph */
  .beautiful-paragraph {
    font-family: 'Arial', sans-serif;
    font-size: 1.1em;
    line-height: 1.5;
    color: #5a5a5a;
    border-left: 4px solid #28a745;
    padding-left: 12px;
    margin-bottom: 15px;
  }

  /* Beautiful styling for the paragraph */
.arima-text {
  font-family: "Arima", system-ui;
  font-optical-sizing: auto;
  font-weight: 600;
  font-style: normal;
}

.teko-text {
font-family: "Teko", sans-serif;
font-optical-sizing: auto;
font-weight: 600;
font-style: normal;
}

.clickable-card {
cursor: pointer;
transition: transform 0.2s;
}

.clickable-card:hover {
transform: scale(1.05);
}

.custom-input-group {
  background-color: #f8f9fa; /* Light background color */
  border-radius: 5px; /* Rounded corners */
  padding: 10px; /* Padding around the group */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

.custom-input-group .input-group-text {
    background-color: #e9ecef; /* Slightly darker background for the label */
    border: none; /* Remove border */
    border-radius: 5px 0 0 5px; /* Rounded corners for the left side */
}

.custom-input {
    border-radius: 0 5px 5px 0; /* Rounded corners for the right side */
    background-color: #ffffff; /* White background for the input */
}
</style>
  

 {% endblock %}